#!/bin/bash -e
    # PROGRAM NAME
    #   matrix
    # EXECUTION
    #   matrix OPERATION [ARGUMENT]...
    #   Performs the specified operation on 0 or more rectangular 
    #   matrix arguments and outputs the result to the console.
    # INPUTS
    #   matrix dims [MATRIX] - reads the file specified or a matrix provided
    #       via stdin
    #   matrix transpose [MATRIX] - reads the file specified or a matrix provided
    #       via stdin
    #   matrix mean [MATRIX] - reads the file specified or a matrix provided
    #       via stdin
    #   matrix add MATRIX_LEFT MATRIX_RIGHT
    #   matrix multiply MATRIX_LEFT MATRIX_RIGHT
    # OUTPUTS
    #   dims - prints the dimensions of the matrix as "[N rows] [M columns]"
    #   transpose - reflects the matrix along the main diagonal.
    #   mean - 1xN row vector, where the first element is the mean of column
    #           one, the second element is the mean of column two, and so on
    #   add - the element-wie sum of two MxN matrices 
    #   multiply - the product of an MxN matrix and NxP matrix
    # AUTHOR
    #   Written by Kendra Ellis (ellisken@oregonstate.edu) for 
    #   CS344 Intro to Operating Systems Project 1 Winter 2018


#-------------------------------------------------------------------
#
#                        GLOBAL VARIABLES 
#
#-------------------------------------------------------------------
matrix=temp_matrix$$
matrix_lt=temp_matrix_left$$
matrix_rt=temp_matrix_rt$$
err_msg0="Wrong number of arguments. Program exiting."
err_msg1="OPERATION unknown. Program exiting."
err_msg2="File(s) unreadable or does/do not exist. Program exiting."
err_msg3="Operation requires two MATRIX arguments. Program exiting."

# Trap statement to clean up in case of interruption, hang up, or termination
trap "rm -f $matrix; rm -f $matrix_lt; rm -f $matrix_rt; echo 'Ctrl-C entered. Exiting'; exit 1" INT HUP TERM 

#-------------------------------------------------------------------
#
#                       FUNCTION DEFINITIONS
#
#-------------------------------------------------------------------

error(){
    # NAME
    #   error()
    # DESCRIPTION
    #   Sends error message to stdout and exits with non-zero status
    # INPUTS
    #   1. A message string 
    # OUTPUTS
    #   Writes to stderr
    # AUTHOR
    #   Kendra Ellis (ellisken@oregonstate.edu)

    echo "$1" >&2
    exit 1
}


    # NAME
    # DESCRIPTION
    # INPUTS
    # OUTPUTS
    # NOTES


#-------------------------------------------------------------------
#
#                         PROGRAM EXECUTION
#
#-------------------------------------------------------------------

# Validate OPERATION specified
if [ "$#" -lt 1 ]
then
    error "$err_msg0"
elif [ "$1" != "dims" ] && [ "$1" != "transpose" ] && [ "$1" != "mean" ] && [ "$1" != "add" ] && [ "$1" != "multiply" ]
then
    error "$err_msg1"
fi


# Handle input processing for "dims" "transpose" or "mean"
if [ "$1" = "dims" ] || [ "$1" = "transpose" ] || [ "$1" = "mean" ]
then
    # If no file specified, use input from stdin
    if [ "$#" == 1 ]
    then
        cat > $matrix

    # Else if file specified, save to tempin
    elif [ "$#" == 2 ]
    then
        if [ -r "$2" ] && [ -e "$2" ]
        then
            cat "$2" > $matrix
        else
            error "$err_msg2"
        fi
    # Else there are too many arguments
    else
        error "$err_msg0"
    fi

# Handle input processing for "add" and "multiply"
else
    # Verify correct # of arguments
    if [ "$#" -lt 3 ] || [ "$#" -gt 3 ]
    then
        error "$err_msg3"
    
    # If # args correct, and files are readable && exist 
    # then store in variables for files
    elif [ -r "$2" ] && [ -e "$2" ] && [ -r "$3" ] && [ -e "$3" ]
    then
        cat "$2" > $matrix_lt
        cat "$3" > $matrix_rt
    else
        error "$err_msg2"
    fi
fi

# Check if file is readable, else exit with error
# Then perform the operation and save in tempout
# Else if operation is add or multiply
# validate number of args, file readability, and matrix
# dimensions using dim
# If invalid, echo error message to stderr and exit
# Else, perform selected operation

# Print contents of tempout file to console and quit


